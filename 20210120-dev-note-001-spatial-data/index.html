<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.2072d913c063a542f3b5.css" id="gatsby-global-css">/*! modern-normalize | MIT License | https://github.com/sindresorhus/modern-normalize */html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}hr{height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{padding:0}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}</style><meta name="generator" content="Gatsby 2.28.1"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://meshkorea.github.io/20210120-dev-note-001-spatial-data/" data-baseprotocol="https:" data-basehost="meshkorea.github.io"/><title data-react-helmet="true">Spatial data를 10,000배 잘 다루게 된 방법  :: Mesh Korea Makers Blog</title><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"/><link data-react-helmet="true" rel="icon" type="image/png" href="/favicon.png" sizes="1024x1024"/><link data-react-helmet="true" rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link data-react-helmet="true" rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link data-react-helmet="true" rel="mask-icon" href="/mask-icon.svg" color="#1b3993"/><link data-react-helmet="true" rel="shortcut icon" href="/favicon.ico"/><meta data-react-helmet="true" name="description" content="안녕하세요. 메쉬코리아 기반서비스서버팀 강성일입니다.
이번에 Spatial data를  10,00…"/><meta data-react-helmet="true" name="keywords" content="Mesh Korea, 메쉬코리아, 블로그, 기술 블로그, tech blog, makers blog, postgis,Dev Notes"/><meta data-react-helmet="true" property="og:url" content="https://meshkorea.github.io/20210120-dev-note-001-spatial-data/"/><meta data-react-helmet="true" property="og:title" content="Spatial data를 10,000배 잘 다루게 된 방법  
            :: Mesh Korea Makers Blog"/><meta data-react-helmet="true" property="og:description" content="안녕하세요. 메쉬코리아 기반서비스서버팀 강성일입니다.
이번에 Spatial data를  10,00…"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:image" content="https://meshkorea.github.io/static/ad64801ca72ee0533e938309b5ed95a0/eeb1b/title.png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#1b3993"/><link rel="apple-touch-icon" sizes="192x192" href="/android-icon-192x192.png"/><link rel="apple-touch-icon" sizes="384x384" href="/android-icon-384x384.png"/><link as="script" rel="preload" href="/webpack-runtime-1294f826c36834da02c4.js"/><link as="script" rel="preload" href="/framework-da68acf1b9295dbf7273.js"/><link as="script" rel="preload" href="/app-22865dd68e8243d4cdbd.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/e0525e89-740ce12359b8b303d957.js"/><link as="script" rel="preload" href="/commons-dcdf0d39b8604fc9401a.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-826d2b9ff3a07b601cb2.js"/><link as="fetch" rel="preload" href="/page-data/20210120-dev-note-001-spatial-data/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1963140206.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css x35p1m-StyledLayoutRoot">.css-x35p1m-StyledLayoutRoot{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;background:#fff;}</style><div class="css-x35p1m-StyledLayoutRoot e3awmat0"><style data-emotion="css-global w0u7it">html{box-sizing:border-box;}*,*::before,*::after{box-sizing:inherit;}html{font-size:16px!important;line-height:1.5!important;}body{width:100%;overflow-x:hidden;overflow-y:scroll;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif;color:#4B5058;background-color:#EFF0F5;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;}a{color:#0971ce;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:focus{-webkit-text-decoration:none;text-decoration:none;}img{max-width:100%;object-fit:contain;}figure{margin:2rem 0;}figcaption{font-size:80%;}table{width:100%;margin-bottom:1rem;border:1px solid #f5f3f7;font-size:85%;border-collapse:collapse;}td,th{padding:0.25rem 0.5rem;border:1px solid #f5f3f7;}th{text-align:left;}tbody tr:nth-of-type(odd) td{background-color:#fbfafc;}tbody tr:nth-of-type(odd) tr{background-color:#fbfafc;}h1,h2,h3,h4,h5,h6{margin-top:1.414rem;margin-bottom:0.5rem;color:inherit;font-weight:700;line-height:1.2;text-rendering:optimizeLegibility;}h1{margin-top:0;font-size:2.441rem;}h2{font-size:1.953rem;}h3{font-size:1.563rem;}h4,h5,h6{font-size:1.25rem;}p{margin-top:0;margin-bottom:1rem;}strong{color:inherit;}ul,ol,dl{margin-top:0;margin-bottom:1rem;}dt{font-weight:bold;}dd{margin-bottom:0.5rem;}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #f5f3f7;}blockquote{margin:0.8rem 0;padding:0.5rem 1rem;border-left:0.25rem solid #f5f3f7;}blockquote p:last-child{margin-bottom:0;}@media (min-width: 48em){blockquote{padding-right:5rem;padding-left:1.25rem;}}code[class*="language-"],pre[class*="language-"]{color:black;background:none;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}@media print{code[class*="language-"],pre[class*="language-"]{text-shadow:none;}}pre[class*="language-"]{padding:1em;margin:0.5em 0;overflow:auto;}:not(pre)>code[class*="language-"]{padding:0.1em;border-radius:0.3em;white-space:normal;}.token.comment,.token.prolog,.token.doctype,.token.cdata{color:slategray;}.token.punctuation{color:#999;}.namespace{opacity:0.7;}.token.property,.token.tag,.token.boolean,.token.number,.token.constant,.token.symbol,.token.deleted{color:#905;}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#690;}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string{color:#9a6e3a;background:hsla(0, 0%, 100%, 0.5);}.token.atrule,.token.attr-value,.token.keyword{color:#07a;}.token.function,.token.class-name{color:#dd4a68;}.token.regex,.token.important,.token.variable{color:#e90;}.token.important,.token.bold{font-weight:bold;}.token.italic{font-style:italic;}.token.entity{cursor:help;}</style><style data-emotion="css jaqxp9-SmallTitleBox">.css-jaqxp9-SmallTitleBox{z-index:105;position:fixed;top:0;left:0;right:0;margin:0;height:75px;padding-top:26px;font-size:1.125rem;font-weight:700;line-height:1.2;background-color:#EFF0F5;}@media (max-width: 38.125em){.css-jaqxp9-SmallTitleBox{height:44px;padding-top:0;left:50px;}}</style><div class="css-jaqxp9-SmallTitleBox e1obetcm3"><style data-emotion="css 1mfk7pj-SmallTitleContainer">.css-1mfk7pj-SmallTitleContainer{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-1mfk7pj-SmallTitleContainer >a{color:inherit;}</style><style data-emotion="css eduyk7-StyledContainer-SmallTitleContainer">.css-eduyk7-StyledContainer-SmallTitleContainer{margin-left:auto;margin-right:auto;width:auto;max-width:71.25rem;padding:0 20px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-eduyk7-StyledContainer-SmallTitleContainer::before,.css-eduyk7-StyledContainer-SmallTitleContainer::after{content:"";display:table;}.css-eduyk7-StyledContainer-SmallTitleContainer::after{clear:both;}@media (max-width: 38.125em){.css-eduyk7-StyledContainer-SmallTitleContainer{padding-left:16px;padding-right:16px;}}.css-eduyk7-StyledContainer-SmallTitleContainer >a{color:inherit;}</style><div class="e1obetcm5 css-eduyk7-StyledContainer-SmallTitleContainer e1ig3f2t0"><a href="/"><style data-emotion="css 282isq-SmallTitle">.css-282isq-SmallTitle{padding-top:7px;font-size:inherit;color:#05cd82;cursor:pointer;-webkit-transition:color 0.5s ease-in;transition:color 0.5s ease-in;}.css-282isq-SmallTitle .link-text{color:#4B5058;opacity:1;-webkit-transition:opacity 0.5s ease-in;transition:opacity 0.5s ease-in;}.css-282isq-SmallTitle i{margin-right:10px;}@media (max-width: 38.125em){.css-282isq-SmallTitle{display:none;}}</style><h1 class="css-282isq-SmallTitle e1obetcm4"><span class="link-text"><style data-emotion="css 1anhml5-IconWrapper">.css-1anhml5-IconWrapper{position:relative;display:inline-block;line-height:16px;color:inherit;}.css-1anhml5-IconWrapper>svg{vertical-align:top;}.css-1anhml5-IconWrapper>svg{fill:currentColor;}</style><i class="css-1anhml5-IconWrapper e12rwrnm0" height="16" title="MESH KOREA | VROONG"><svg width="242" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 271.53 18"><path d="M199.71,6.65a2.59,2.59,0,1,0,0-5.17H187V16.76h5.17V10.31l6.45,6.45h3.66V13.1l-6.45-6.45Z" fill="#05cd82"></path><path d="M210.81.65a8.47,8.47,0,1,0,8.52,8.47A8.5,8.5,0,0,0,210.81.65Zm0,12.09a3.52,3.52,0,0,1-3.41-3.62,3.42,3.42,0,1,1,6.83,0A3.52,3.52,0,0,1,210.81,12.74Z" fill="#05cd82"></path><polygon points="177.23 9.8 173.81 1.48 167.89 1.48 174.8 16.76 179.5 16.76 186.58 1.48 180.66 1.48 177.23 9.8" fill="#05cd82"></polygon><path d="M228.52.65A8.47,8.47,0,1,0,237,9.12,8.5,8.5,0,0,0,228.52.65Zm0,12.09a3.52,3.52,0,0,1-3.42-3.62,3.42,3.42,0,1,1,6.83,0A3.52,3.52,0,0,1,228.52,12.74Z" fill="#05cd82"></path><path d="M271.12,7.62H263V11h3.37a3.23,3.23,0,0,1-3,1.72,3.5,3.5,0,0,1-2.58-1.09,3.59,3.59,0,0,1-1.06-2.6,3.65,3.65,0,0,1,1-2.59,3.26,3.26,0,0,1,2.46-1.08,3.31,3.31,0,0,1,1.68.45,3.18,3.18,0,0,1,.77.58l4.18-2.68a8.46,8.46,0,0,0-6.62-3.1,8.08,8.08,0,0,0-6,2.51,8.19,8.19,0,0,0-2.47,6,8.49,8.49,0,0,0,8.51,8.47,8.24,8.24,0,0,0,8-8.47A8.21,8.21,0,0,0,271.12,7.62Z" fill="#05cd82"></path><polygon points="248.69 8.8 242.96 1.48 237.94 1.48 237.94 16.76 243.12 16.76 243.12 9.44 248.85 16.76 253.86 16.76 253.86 1.48 248.69 1.48 248.69 8.8" fill="#05cd82"></polygon><path d="M106.37,6.3c0-3.17-2.19-4.77-5.45-4.77H94.58V16.67h3.19v-5.6h2.47l3.26,5.6h3.61l-3.65-6A4.29,4.29,0,0,0,106.37,6.3ZM101,8.36H97.75V4.42H101c1.38,0,2.34.59,2.34,2S102.37,8.36,101,8.36Z" fill="#0071ce"></path><polygon points="20.72 10.05 26.95 10.05 26.95 7.11 20.72 7.11 20.72 4.5 28.2 4.5 28.2 1.53 17.69 1.53 17.69 16.67 28.52 16.67 28.52 13.71 20.72 13.71 20.72 10.05" fill="#0071ce"></polygon><polygon points="53.94 7.33 47.73 7.33 47.73 1.53 44.71 1.53 44.71 16.67 47.73 16.67 47.73 10.31 53.94 10.31 53.94 16.67 56.97 16.67 56.97 1.53 53.94 1.53 53.94 7.33" fill="#0071ce"></polygon><path d="M85.36,1.17c-4,0-6.81,3-6.81,8S81.3,17,85.32,17s6.78-3,6.78-7.94S89.36,1.17,85.36,1.17Zm0,12.8c-2.15,0-3.65-1.78-3.65-4.89s1.43-4.85,3.58-4.85S88.94,6,88.94,9.12,87.51,14,85.36,14Z" fill="#0071ce"></path><polygon points="112.64 10.05 118.87 10.05 118.87 7.11 112.64 7.11 112.64 4.5 120.12 4.5 120.12 1.53 109.61 1.53 109.61 16.67 120.45 16.67 120.45 13.71 112.64 13.71 112.64 10.05" fill="#0071ce"></polygon><path d="M130.53,1.53h-2.94L121.8,16.67H125l1.19-3.37h5.54L133,16.67h3.33Zm-3.26,8.89,1-2.75c.31-.88.61-1.79.76-2.35.15.56.45,1.47.76,2.35l1,2.75Z" fill="#0071ce"></path><path d="M7.35,8.18,3.2,1.53H.25V16.67h3V10.6c0-1.25,0-2.42,0-3.51l0,0C4,8.14,4.55,9.25,5.25,10.31L7,13h.54l1.76-2.7c.69-1.06,1.43-2.17,2.08-3.24l0,0c0,1.09,0,2.26,0,3.51v6.07h3V1.53H11.5Z" fill="#0071ce"></path><path d="M37.13,7.5c-2.36-.55-3-1.15-3-2.09,0-.66.54-1.34,2.13-1.34A4.56,4.56,0,0,1,39.65,5.6L41.8,3.52a7.14,7.14,0,0,0-5.43-2.35C33.43,1.17,31,2.83,31,5.54c0,2.94,1.92,4.11,4.67,4.75S39,11.53,39,12.49c0,1.13-.83,1.62-2.6,1.62a4.8,4.8,0,0,1-3.81-1.71l-2.15,1.92A6.91,6.91,0,0,0,36.26,17c4.06,0,5.85-1.91,5.85-4.74C42.11,9,39.49,8.05,37.13,7.5Z" fill="#0071ce"></path><polygon points="78.14 1.53 74.1 1.53 69.07 7.89 69.07 1.53 66.04 1.53 66.04 16.65 69.07 16.65 69.07 9.82 74.48 16.65 74.48 16.65 78.49 16.65 72.23 8.74 78.14 1.53" fill="#0071ce"></polygon><rect x="152.04" y="1.53" width="1.14" height="15.22" fill="#3e3a39"></rect></svg></i>Tech Blog</span></h1></a><div style="flex:1"></div><style data-emotion="css 22578y-RecruitLinks">.css-22578y-RecruitLinks{font-size:1rem;text-align:right;color:#0971ce;}.css-22578y-RecruitLinks >a{display:inline-block;min-width:36px;height:36px;padding-top:6px;text-align:center;line-height:24px;border-radius:18px;-webkit-transition:color 0.3s,background 0.5s;transition:color 0.3s,background 0.5s;}.css-22578y-RecruitLinks >a:hover,.css-22578y-RecruitLinks >a:focus{color:#fff;-webkit-text-decoration:none;text-decoration:none;background:#0971ce;}@media (max-width: 38.125em){.css-22578y-RecruitLinks >a{color:#5B5E62;margin:4px 0;border-radius:5px;}.css-22578y-RecruitLinks >a:hover,.css-22578y-RecruitLinks >a:focus{color:#4B5058;background:#E2E4EB;}}</style><div class="css-22578y-RecruitLinks e1obetcm2"><a href="https://github.com/meshkorea" target="_blank"><style data-emotion="css g8nddb-IconWrapper">.css-g8nddb-IconWrapper{position:relative;display:inline-block;line-height:24px;color:inherit;}.css-g8nddb-IconWrapper>svg{vertical-align:top;}.css-g8nddb-IconWrapper>svg{fill:currentColor;}</style><i class="css-g8nddb-IconWrapper e12rwrnm0" height="24"><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,0A12,12,0,0,0,8.21,23.39c.6.11.82-.26.82-.58s0-1,0-2c-3.34.72-4-1.61-4-1.61A3.21,3.21,0,0,0,3.64,17.4c-1.09-.74.08-.73.08-.73a2.55,2.55,0,0,1,1.84,1.24,2.56,2.56,0,0,0,3.49,1,2.59,2.59,0,0,1,.76-1.61C7.15,17,4.34,16,4.34,11.37A4.63,4.63,0,0,1,5.58,8.15,4.28,4.28,0,0,1,5.7,5s1-.33,3.3,1.23a11.18,11.18,0,0,1,6,0C17.3,4.65,18.3,5,18.3,5a4.28,4.28,0,0,1,.12,3.17,4.63,4.63,0,0,1,1.23,3.22c0,4.61-2.8,5.63-5.47,5.92A2.88,2.88,0,0,1,15,19.52c0,1.6,0,2.89,0,3.29s.21.69.82.58A12,12,0,0,0,12,0Z"></path></svg></i></a><style data-emotion="css 17ctmwo-RecruitLink">.css-17ctmwo-RecruitLink{margin-left:12px;padding-top:5px!important;padding-left:1.25rem;padding-right:1.25rem;font-weight:600;border:1px solid #0971ce;}@media (max-width: 38.125em){.css-17ctmwo-RecruitLink{margin-left:0.6rem;margin-right:-0.625rem;padding-left:0.625rem;padding-right:0.625rem;line-height:26px;font-weight:400;color:#5B5E62;border:none;}}</style><a href="https://www.meshkorea.net/kr/career/" target="_blank" class="css-17ctmwo-RecruitLink e1obetcm1">지금 지원하러 가기</a></div></div></div><style data-emotion="css 1492abv-StyledHeader">.css-1492abv-StyledHeader{position:fixed;top:-125px;left:0;right:0;z-index:100;height:215px;padding:110px 0 0;color:#4B5058;border-bottom:1px solid #E2E4EB;background-color:#EFF0F5;}@media (max-width: 38.125em){.css-1492abv-StyledHeader{top:-51px;height:96px;padding-top:58px;-webkit-transition:height 0.3s;transition:height 0.3s;}}</style><header class="css-1492abv-StyledHeader e1obetcm9"><style data-emotion="css 2028mn-StyledContainer">.css-2028mn-StyledContainer{margin-left:auto;margin-right:auto;width:auto;max-width:71.25rem;padding:0 20px;}.css-2028mn-StyledContainer::before,.css-2028mn-StyledContainer::after{content:"";display:table;}.css-2028mn-StyledContainer::after{clear:both;}@media (max-width: 38.125em){.css-2028mn-StyledContainer{padding-left:16px;padding-right:16px;}}</style><div class="css-2028mn-StyledContainer e1ig3f2t0"><style data-emotion="css 1htaa58-LogoContainer">.css-1htaa58-LogoContainer{white-space:nowrap;overflow:hidden;}@media (min-width: 38.125em){.css-1htaa58-LogoContainer{display:none;}}</style><div class="css-1htaa58-LogoContainer e1obetcm8"><style data-emotion="css 93x8qt-HomepageLink">.css-93x8qt-HomepageLink{color:inherit;}.css-93x8qt-HomepageLink:hover,.css-93x8qt-HomepageLink:focus{-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-93x8qt-HomepageLink e1obetcm0" href="/"><style data-emotion="css l9mnzg-Logo">.css-l9mnzg-Logo{width:133px;height:24px;}@media (max-width: 38.125em){.css-l9mnzg-Logo{display:inline-block;width:26px;height:30px;overflow:hidden;color:#05cd82;}}</style><div class="css-l9mnzg-Logo e1obetcm7"><style data-emotion="css vi10os-IconWrapper">.css-vi10os-IconWrapper{position:relative;display:inline-block;line-height:18px;color:inherit;}.css-vi10os-IconWrapper>svg{vertical-align:top;}.css-vi10os-IconWrapper>svg{fill:currentColor;}</style><i class="css-vi10os-IconWrapper e12rwrnm0" height="18"><svg width="271.53" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 271.53 18"><path d="M199.71,6.65a2.59,2.59,0,1,0,0-5.17H187V16.76h5.17V10.31l6.45,6.45h3.66V13.1l-6.45-6.45Z" fill="#05cd82"></path><path d="M210.81.65a8.47,8.47,0,1,0,8.52,8.47A8.5,8.5,0,0,0,210.81.65Zm0,12.09a3.52,3.52,0,0,1-3.41-3.62,3.42,3.42,0,1,1,6.83,0A3.52,3.52,0,0,1,210.81,12.74Z" fill="#05cd82"></path><polygon points="177.23 9.8 173.81 1.48 167.89 1.48 174.8 16.76 179.5 16.76 186.58 1.48 180.66 1.48 177.23 9.8" fill="#05cd82"></polygon><path d="M228.52.65A8.47,8.47,0,1,0,237,9.12,8.5,8.5,0,0,0,228.52.65Zm0,12.09a3.52,3.52,0,0,1-3.42-3.62,3.42,3.42,0,1,1,6.83,0A3.52,3.52,0,0,1,228.52,12.74Z" fill="#05cd82"></path><path d="M271.12,7.62H263V11h3.37a3.23,3.23,0,0,1-3,1.72,3.5,3.5,0,0,1-2.58-1.09,3.59,3.59,0,0,1-1.06-2.6,3.65,3.65,0,0,1,1-2.59,3.26,3.26,0,0,1,2.46-1.08,3.31,3.31,0,0,1,1.68.45,3.18,3.18,0,0,1,.77.58l4.18-2.68a8.46,8.46,0,0,0-6.62-3.1,8.08,8.08,0,0,0-6,2.51,8.19,8.19,0,0,0-2.47,6,8.49,8.49,0,0,0,8.51,8.47,8.24,8.24,0,0,0,8-8.47A8.21,8.21,0,0,0,271.12,7.62Z" fill="#05cd82"></path><polygon points="248.69 8.8 242.96 1.48 237.94 1.48 237.94 16.76 243.12 16.76 243.12 9.44 248.85 16.76 253.86 16.76 253.86 1.48 248.69 1.48 248.69 8.8" fill="#05cd82"></polygon><path d="M106.37,6.3c0-3.17-2.19-4.77-5.45-4.77H94.58V16.67h3.19v-5.6h2.47l3.26,5.6h3.61l-3.65-6A4.29,4.29,0,0,0,106.37,6.3ZM101,8.36H97.75V4.42H101c1.38,0,2.34.59,2.34,2S102.37,8.36,101,8.36Z" fill="#0071ce"></path><polygon points="20.72 10.05 26.95 10.05 26.95 7.11 20.72 7.11 20.72 4.5 28.2 4.5 28.2 1.53 17.69 1.53 17.69 16.67 28.52 16.67 28.52 13.71 20.72 13.71 20.72 10.05" fill="#0071ce"></polygon><polygon points="53.94 7.33 47.73 7.33 47.73 1.53 44.71 1.53 44.71 16.67 47.73 16.67 47.73 10.31 53.94 10.31 53.94 16.67 56.97 16.67 56.97 1.53 53.94 1.53 53.94 7.33" fill="#0071ce"></polygon><path d="M85.36,1.17c-4,0-6.81,3-6.81,8S81.3,17,85.32,17s6.78-3,6.78-7.94S89.36,1.17,85.36,1.17Zm0,12.8c-2.15,0-3.65-1.78-3.65-4.89s1.43-4.85,3.58-4.85S88.94,6,88.94,9.12,87.51,14,85.36,14Z" fill="#0071ce"></path><polygon points="112.64 10.05 118.87 10.05 118.87 7.11 112.64 7.11 112.64 4.5 120.12 4.5 120.12 1.53 109.61 1.53 109.61 16.67 120.45 16.67 120.45 13.71 112.64 13.71 112.64 10.05" fill="#0071ce"></polygon><path d="M130.53,1.53h-2.94L121.8,16.67H125l1.19-3.37h5.54L133,16.67h3.33Zm-3.26,8.89,1-2.75c.31-.88.61-1.79.76-2.35.15.56.45,1.47.76,2.35l1,2.75Z" fill="#0071ce"></path><path d="M7.35,8.18,3.2,1.53H.25V16.67h3V10.6c0-1.25,0-2.42,0-3.51l0,0C4,8.14,4.55,9.25,5.25,10.31L7,13h.54l1.76-2.7c.69-1.06,1.43-2.17,2.08-3.24l0,0c0,1.09,0,2.26,0,3.51v6.07h3V1.53H11.5Z" fill="#0071ce"></path><path d="M37.13,7.5c-2.36-.55-3-1.15-3-2.09,0-.66.54-1.34,2.13-1.34A4.56,4.56,0,0,1,39.65,5.6L41.8,3.52a7.14,7.14,0,0,0-5.43-2.35C33.43,1.17,31,2.83,31,5.54c0,2.94,1.92,4.11,4.67,4.75S39,11.53,39,12.49c0,1.13-.83,1.62-2.6,1.62a4.8,4.8,0,0,1-3.81-1.71l-2.15,1.92A6.91,6.91,0,0,0,36.26,17c4.06,0,5.85-1.91,5.85-4.74C42.11,9,39.49,8.05,37.13,7.5Z" fill="#0071ce"></path><polygon points="78.14 1.53 74.1 1.53 69.07 7.89 69.07 1.53 66.04 1.53 66.04 16.65 69.07 16.65 69.07 9.82 74.48 16.65 74.48 16.65 78.49 16.65 72.23 8.74 78.14 1.53" fill="#0071ce"></polygon><rect x="152.04" y="1.53" width="1.14" height="15.22" fill="#3e3a39"></rect></svg></i></div><style data-emotion="css yek61y-Title">.css-yek61y-Title{font-size:3rem;margin:6px 0 0;font-weight:700;line-height:1.2;letter-spacing:-0.015em;}@media (max-width: 38.125em){.css-yek61y-Title{display:inline-block;margin:0 0 0 14px;font-size:1.125rem;line-height:30px;vertical-align:top;}}@media (max-width: 23.125em){.css-yek61y-Title{font-size:0.875rem;}}</style><h1 class="css-yek61y-Title e1obetcm6">Tech Blog</h1></a></div></div></header><style data-emotion="css 1gp6gx1-StyledLayoutMain">.css-1gp6gx1-StyledLayoutMain{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex:1;-ms-flex:1;flex:1;padding-top:90px;}@media (max-width: 38.125em){.css-1gp6gx1-StyledLayoutMain{padding-top:97px;}}</style><main class="css-1gp6gx1-StyledLayoutMain ewf609k0"><style data-emotion="css 1scz8kd-StyledPage">.css-1scz8kd-StyledPage{display:block;-webkit-flex:1;-ms-flex:1;flex:1;position:relative;padding:0;margin-bottom:3rem;}</style><div class="css-1scz8kd-StyledPage e9n6qsq0"><style data-emotion="css 6b1s3v-Wrapper">.css-6b1s3v-Wrapper{height:360px;font-size:1.125em;color:#fff;text-shadow:0 2px 4px rgba(0, 0, 0, 0.5);background-color:#7A7F86;-webkit-background-position:50% 50%;background-position:50% 50%;-webkit-background-size:cover;background-size:cover;background-image:url(/static/ad64801ca72ee0533e938309b5ed95a0/eeb1b/title.png);}</style><div style="background-position:50% 50%" class="css-6b1s3v-Wrapper e140x8tc2"><style data-emotion="css fqnm68-PostTitleContainer">.css-fqnm68-PostTitleContainer{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;height:100%;padding:0 90px 20px;}.css-fqnm68-PostTitleContainer >div span{margin-right:0.4em;cursor:pointer;opacity:0.75;-webkit-transition:opacity 0.5s;transition:opacity 0.5s;}.css-fqnm68-PostTitleContainer >div span:hover{opacity:1;}@media (min-width: 38.125em) and (max-width: 48em){.css-fqnm68-PostTitleContainer{padding-left:60px;padding-right:60px;}}@media (max-width: 38.125em){.css-fqnm68-PostTitleContainer{padding-left:56px;padding-right:56px;}}@media (min-width: 30em) and (max-width: 38.125em){.css-fqnm68-PostTitleContainer{padding-left:56px;padding-right:56px;}}@media (max-width: 30em){.css-fqnm68-PostTitleContainer{padding-left:16px;padding-right:16px;}}</style><style data-emotion="css bb5jcx-StyledContainer-PostTitleContainer">.css-bb5jcx-StyledContainer-PostTitleContainer{margin-left:auto;margin-right:auto;width:auto;max-width:71.25rem;padding:0 20px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;height:100%;padding:0 90px 20px;}.css-bb5jcx-StyledContainer-PostTitleContainer::before,.css-bb5jcx-StyledContainer-PostTitleContainer::after{content:"";display:table;}.css-bb5jcx-StyledContainer-PostTitleContainer::after{clear:both;}@media (max-width: 38.125em){.css-bb5jcx-StyledContainer-PostTitleContainer{padding-left:16px;padding-right:16px;}}.css-bb5jcx-StyledContainer-PostTitleContainer >div span{margin-right:0.4em;cursor:pointer;opacity:0.75;-webkit-transition:opacity 0.5s;transition:opacity 0.5s;}.css-bb5jcx-StyledContainer-PostTitleContainer >div span:hover{opacity:1;}@media (min-width: 38.125em) and (max-width: 48em){.css-bb5jcx-StyledContainer-PostTitleContainer{padding-left:60px;padding-right:60px;}}@media (max-width: 38.125em){.css-bb5jcx-StyledContainer-PostTitleContainer{padding-left:56px;padding-right:56px;}}@media (min-width: 30em) and (max-width: 38.125em){.css-bb5jcx-StyledContainer-PostTitleContainer{padding-left:56px;padding-right:56px;}}@media (max-width: 30em){.css-bb5jcx-StyledContainer-PostTitleContainer{padding-left:16px;padding-right:16px;}}</style><div class="e140x8tc1 css-bb5jcx-StyledContainer-PostTitleContainer e1ig3f2t0"><style data-emotion="css 1g33qqm-PostTitle">.css-1g33qqm-PostTitle{font-size:2.5rem;margin:0;word-break:keep-all;}@media (max-width: 48em){.css-1g33qqm-PostTitle{font-size:2rem;}}</style><h1 class="css-1g33qqm-PostTitle e140x8tc0">Spatial data를 10,000배 잘 다루게 된 방법  </h1><div><style data-emotion="css 1muk9kd-StyledLink">.css-1muk9kd-StyledLink{display:inline-block;word-break:break-all;color:inherit;-webkit-transition:text-shadow 0.3s;transition:text-shadow 0.3s;}.css-1muk9kd-StyledLink:not(:last-of-type){margin-right:0.5em;}</style><a class="css-1muk9kd-StyledLink e1esqkvg0" href="/tags/postgis">#<!-- -->postgis</a><a class="css-1muk9kd-StyledLink e1esqkvg0" href="/tags/Dev Notes">#<!-- -->Dev Notes</a></div></div></div><style data-emotion="css sz93qs-PostContainer">.css-sz93qs-PostContainer{position:relative;}</style><style data-emotion="css nokxz1-StyledContainer-PostContainer">.css-nokxz1-StyledContainer-PostContainer{margin-left:auto;margin-right:auto;width:auto;max-width:71.25rem;padding:0 20px;position:relative;}.css-nokxz1-StyledContainer-PostContainer::before,.css-nokxz1-StyledContainer-PostContainer::after{content:"";display:table;}.css-nokxz1-StyledContainer-PostContainer::after{clear:both;}@media (max-width: 38.125em){.css-nokxz1-StyledContainer-PostContainer{padding-left:16px;padding-right:16px;}}</style><div class="edaxc5g8 css-nokxz1-StyledContainer-PostContainer e1ig3f2t0"><style data-emotion="css m5nmoe-ShareSheet">.css-m5nmoe-ShareSheet{position:absolute;top:40px;right:50%;font-size:0.75rem;font-weight:500;text-align:right;color:#90959B;-webkit-transform:translateX(550px);-moz-transform:translateX(550px);-ms-transform:translateX(550px);transform:translateX(550px);}.css-m5nmoe-ShareSheet a,.css-m5nmoe-ShareSheet .SocialMediaShareButton{position:relative;display:block;margin-left:auto;margin-bottom:0.625rem;width:24px;color:#B9BDC1;cursor:pointer;-webkit-transition:color 0.5s;transition:color 0.5s;}.css-m5nmoe-ShareSheet a:hover,.css-m5nmoe-ShareSheet .SocialMediaShareButton:hover{color:#90959B;}.css-m5nmoe-ShareSheet a:focus,.css-m5nmoe-ShareSheet .SocialMediaShareButton:focus{outline:0;}.css-m5nmoe-ShareSheet a:hover::before{position:absolute;top:0.5rem;right:26px;width:0;height:0;content:attr(title);color:rgba(0, 0, 0, 0);overflow:hidden;border-left:4px solid rgba(0, 0, 0, 0.5);border-top:4px solid transparent;border-bottom:4px solid transparent;}.css-m5nmoe-ShareSheet a:hover::after{position:absolute;top:0.125rem;right:30px;content:attr(title);padding:0 10px;font-size:1.167em;white-space:nowrap;color:#fff;border-radius:5px;background:rgba(0, 0, 0, 0.5);}@media (max-width: 75em){.css-m5nmoe-ShareSheet{display:none;}}</style><aside class="css-m5nmoe-ShareSheet edaxc5g7"><style data-emotion="css 766jc8-ShareSheetTitles">.css-766jc8-ShareSheetTitles{margin:1rem 0 5px;font-size:1em;font-weight:inherit;}.css-766jc8-ShareSheetTitles:first-of-type{margin-top:0;}</style><h5 class="css-766jc8-ShareSheetTitles edaxc5g6">Share</h5><div role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--facebook"><i class="css-g8nddb-IconWrapper e12rwrnm0" height="24"><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.68,0H1.32A1.32,1.32,0,0,0,0,1.32V22.67A1.33,1.33,0,0,0,1.32,24H12.83V14.72H9.7V11.08h3.13V8.41c0-3.1,1.89-4.79,4.66-4.79.93,0,1.86,0,2.79.14V7H18.37c-1.5,0-1.8.72-1.8,1.77v2.31h3.6l-.47,3.63H16.55V24h6.13A1.33,1.33,0,0,0,24,22.67h0V1.32A1.32,1.32,0,0,0,22.68,0Z"></path></svg></i></div><div role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--twitter"><i class="css-g8nddb-IconWrapper e12rwrnm0" height="24"><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.89,21A12.84,12.84,0,0,0,20.82,8.07c0-.2,0-.39,0-.59a9.18,9.18,0,0,0,2.26-2.35,9.08,9.08,0,0,1-2.61.71,4.54,4.54,0,0,0,2-2.51,9.05,9.05,0,0,1-2.88,1.1,4.55,4.55,0,0,0-7.86,3.11,5.1,5.1,0,0,0,.11,1A12.9,12.9,0,0,1,2.47,3.83,4.54,4.54,0,0,0,3.87,9.9a4.59,4.59,0,0,1-2-.57v.06a4.54,4.54,0,0,0,3.64,4.45,4.7,4.7,0,0,1-1.2.16,4.8,4.8,0,0,1-.85-.08,4.54,4.54,0,0,0,4.24,3.15A9.09,9.09,0,0,1,2,19,9.51,9.51,0,0,1,.93,19a12.82,12.82,0,0,0,7,2"></path></svg></i></div><h5 class="css-766jc8-ShareSheetTitles edaxc5g6">See also</h5><a href="https://github.com/Luavis/luavis.github.io/blob/master/_posts/server/2020-11-19-how-to-deal-with-spatial-data.md" target="_blank" title="GitHub 저장소 바로가기"><i class="css-g8nddb-IconWrapper e12rwrnm0" height="24"><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,0A12,12,0,0,0,8.21,23.39c.6.11.82-.26.82-.58s0-1,0-2c-3.34.72-4-1.61-4-1.61A3.21,3.21,0,0,0,3.64,17.4c-1.09-.74.08-.73.08-.73a2.55,2.55,0,0,1,1.84,1.24,2.56,2.56,0,0,0,3.49,1,2.59,2.59,0,0,1,.76-1.61C7.15,17,4.34,16,4.34,11.37A4.63,4.63,0,0,1,5.58,8.15,4.28,4.28,0,0,1,5.7,5s1-.33,3.3,1.23a11.18,11.18,0,0,1,6,0C17.3,4.65,18.3,5,18.3,5a4.28,4.28,0,0,1,.12,3.17,4.63,4.63,0,0,1,1.23,3.22c0,4.61-2.8,5.63-5.47,5.92A2.88,2.88,0,0,1,15,19.52c0,1.6,0,2.89,0,3.29s.21.69.82.58A12,12,0,0,0,12,0Z"></path></svg></i></a><a href="https://b.luavis.kr/server/how-to-deal-with-spatial-data" target="_blank" title="관련 링크"><i class="css-g8nddb-IconWrapper e12rwrnm0" height="24"><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,0A12,12,0,1,0,24,12,12,12,0,0,0,12,0Zm6.3,19.6L9.7,14.3l-.1-.1-4.5-9c-.1-.3.3-.7.6-.5L14.3,10l.1.1,4.5,9C19,19.4,18.6,19.8,18.3,19.6Z"></path><circle cx="12" cy="12" r="2"></circle></svg></i></a></aside><style data-emotion="css 1sykmk4-AuthorInfo-PostAuthorInfo">.css-1sykmk4-AuthorInfo-PostAuthorInfo{margin-top:10px;margin-top:40px;}.css-1sykmk4-AuthorInfo-PostAuthorInfo::before,.css-1sykmk4-AuthorInfo-PostAuthorInfo::after{content:"";display:table;}.css-1sykmk4-AuthorInfo-PostAuthorInfo::after{clear:both;}@media (min-width: 30em) and (max-width: 48em){.css-1sykmk4-AuthorInfo-PostAuthorInfo{padding-left:40px;}}@media (max-width: 30em){.css-1sykmk4-AuthorInfo-PostAuthorInfo{padding-left:0;}}</style><aside class="css-1sykmk4-AuthorInfo-PostAuthorInfo edaxc5g3"><style data-emotion="css 11t6lj4-AuthorAvatar-PostAuthorAvatar">.css-11t6lj4-AuthorAvatar-PostAuthorAvatar{float:left;margin:0;width:3rem;height:3rem;border-radius:1.5rem;background-color:#EFF0F5;-webkit-background-position:50% 50%;background-position:50% 50%;-webkit-background-size:cover;background-size:cover;background-image:url(/static/2effd74b992c028704e743fcc1a02cc3/a2408/sungil.kang.png);}@media (max-width: 48em){.css-11t6lj4-AuthorAvatar-PostAuthorAvatar{float:none;margin-bottom:0.75rem;width:2.25rem;height:2.25rem;}}</style><figure src="/static/2effd74b992c028704e743fcc1a02cc3/a2408/sungil.kang.png" class="css-11t6lj4-AuthorAvatar-PostAuthorAvatar edaxc5g4"></figure><style data-emotion="css 1wratvv-AuthorName-PostAuthorName">.css-1wratvv-AuthorName-PostAuthorName{display:block;margin:4px 0 0 60px;font-weight:600;line-height:1.3;color:#4B5058;margin-top:2px;margin-left:70px;font-size:1.125rem;}@media (max-width: 48em){.css-1wratvv-AuthorName-PostAuthorName{margin-left:0;}}</style><strong class="css-1wratvv-AuthorName-PostAuthorName edaxc5g2">강성일</strong><style data-emotion="css 5vph4m-AuthorDesc-PostAuthorDesc">.css-5vph4m-AuthorDesc-PostAuthorDesc{margin-left:60px;font-size:0.875rem;color:#90959B;margin-left:70px;}@media (max-width: 48em){.css-5vph4m-AuthorDesc-PostAuthorDesc{margin-left:0;}}</style><aside class="css-5vph4m-AuthorDesc-PostAuthorDesc edaxc5g1">서비스개발본부에서 기반서비스서버 팀의 테크리드를 담당하고 있습니다.</aside><style data-emotion="css sja78i-AuthorDesc-PostAuthorDesc-PostDate">.css-sja78i-AuthorDesc-PostAuthorDesc-PostDate{margin-left:60px;font-size:0.875rem;color:#90959B;margin-left:70px;margin-top:1.125rem;margin-bottom:1.5rem;}@media (max-width: 48em){.css-sja78i-AuthorDesc-PostAuthorDesc-PostDate{margin-left:0;}}@media (max-width: 48em){.css-sja78i-AuthorDesc-PostAuthorDesc-PostDate{margin-top:0;}}</style><aside class="css-sja78i-AuthorDesc-PostAuthorDesc-PostDate edaxc5g0">2021-01-20</aside></aside><style data-emotion="css 1xa252c-PostWrapper">.css-1xa252c-PostWrapper{font-size:1.25rem;}@media (max-width: 48em){.css-1xa252c-PostWrapper{margin-left:0;}}@media (max-width: 38.125em){.css-1xa252c-PostWrapper{font-size:1.125rem;}}@media (max-width: 30em){.css-1xa252c-PostWrapper{font-size:1rem;}}</style><article id="article" class="css-1xa252c-PostWrapper edaxc5g9"><style data-emotion="css nlx8yd-TOCWrapper">.css-nlx8yd-TOCWrapper{color:#B9BDC1;-webkit-transition:color 0.5s;transition:color 0.5s;}.css-nlx8yd-TOCWrapper:hover{color:#7A7F86;}.css-nlx8yd-TOCWrapper >i{position:absolute;top:auto;margin-top:0.15em;width:30px;line-height:1.5rem;cursor:pointer;}.css-nlx8yd-TOCWrapper >i .short{-webkit-transition:width 0.5s;transition:width 0.5s;}.css-nlx8yd-TOCWrapper >i:hover .short{width:18px!important;}@media (max-width: 38.125em){.css-nlx8yd-TOCWrapper{display:none;}.css-nlx8yd-TOCWrapper >i{display:block;top:44px;left:0;margin-top:0;width:56px;height:50px;z-index:1100;padding:10px 36px 10px 16px;}}</style><nav class="css-nlx8yd-TOCWrapper e12xq6cv1"><i class="css-g8nddb-IconWrapper e12rwrnm0" height="24"><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="2" rx="1" ry="1"></rect><rect class="short" x="3" y="17" width="13" height="2" rx="1" ry="1"></rect><rect class="short" x="3" y="5" width="13" height="2" rx="1" ry="1"></rect></svg></i><style data-emotion="css 1nabgxc-TOCList">.css-1nabgxc-TOCList{position:absolute;top:auto;margin-top:-10px;z-index:50;margin-left:30px;width:0;height:0;font-size:1rem;}.css-1nabgxc-TOCList ul{margin:0;padding:0;list-style:none;list-style-image:none;}.css-1nabgxc-TOCList ul p{margin:0;}.css-1nabgxc-TOCList ul a{display:block;margin-left:-0.5rem;margin-right:-0.5rem;padding:0.3rem 0.5rem;border-radius:0.5rem;-webkit-transition:background-color 0.5s;transition:background-color 0.5s;}.css-1nabgxc-TOCList ul a:hover{background-color:#EFF0F5;}.css-1nabgxc-TOCList ul:not(:first-of-type){padding-left:1rem;}.css-1nabgxc-TOCList >ul{visibility:hidden;opacity:0;-webkit-transition:visibility 0s 0.5s,opacity 0.5s;transition:visibility 0s 0.5s,opacity 0.5s;width:320px;max-height:360px;overflow-y:auto;padding:0.5rem 1rem;background:#fff;border-radius:10px;box-shadow:0px 2px 4px rgba(0, 0, 0, 0.5);}@media (max-width: 38.125em){.css-1nabgxc-TOCList{top:89px;left:0;right:0;margin-top:0;margin-left:0;width:100%;}.css-1nabgxc-TOCList >ul{width:100%;box-shadow:none;border-radius:0;border-bottom:1px solid #E2E4EB;}}</style><div class="css-1nabgxc-TOCList e12xq6cv0"><ul>
<li><a href="/20210120-dev-note-001-spatial-data/#spatial-data%EC%9D%98-intersects%EC%9D%98-%EA%B3%84%EC%82%B0-%EB%B0%A9%EB%B2%95">Spatial data의 intersects의 계산 방법</a></li>
<li><a href="/20210120-dev-note-001-spatial-data/#%EA%B7%B8%EB%9F%AC%EB%A9%B4-%EB%AC%B8%EC%A0%9C%EB%8A%94-%EC%96%B4%EB%94%94%EC%84%9C-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94%EA%B1%B8%EA%B9%8C">그러면 문제는 어디서 발생하는걸까?</a></li>
<li><a href="/20210120-dev-note-001-spatial-data/#%EA%B2%B0%EB%A1%A0">결론</a></li>
<li><a href="/20210120-dev-note-001-spatial-data/#%EB%A7%88%EC%B9%98%EB%A9%B0">마치며</a></li>
</ul></div></nav><style data-emotion="css 8o6tot-Article">.css-8o6tot-Article{padding:0 70px;}.css-8o6tot-Article >*{margin:1.5em 0;}.css-8o6tot-Article .image-wrapper{margin-left:-70px;margin-right:-70px;text-align:center;}.css-8o6tot-Article .image-caption{margin-top:0.75em;font-size:0.833em;text-align:center;color:#7A7F86;}.css-8o6tot-Article >p{line-height:1.75;}.css-8o6tot-Article li>p,.css-8o6tot-Article li>ul{margin-bottom:0;}.css-8o6tot-Article pre,.css-8o6tot-Article code,.css-8o6tot-Article kbd,.css-8o6tot-Article samp{padding:0.125em 0.3125em;white-space:pre-wrap;font-size:0.889rem;background:#F7F8FC;border-radius:3px;}.css-8o6tot-Article p>code,.css-8o6tot-Article li>code{vertical-align:1px;word-break:break-word;}.css-8o6tot-Article pre{padding-top:0.5em;padding-bottom:0.5em;}.css-8o6tot-Article pre code{background:none;padding:0;}.css-8o6tot-Article a:hover,.css-8o6tot-Article a:active{-webkit-text-decoration:underline;text-decoration:underline;}.css-8o6tot-Article a.anchor{margin-left:-1.5rem;padding-right:0.5rem;line-height:1.1;color:#90959B;}.css-8o6tot-Article a.anchor >svg{fill:#90959B;}@media (min-width: 30em) and (max-width: 48em){.css-8o6tot-Article{padding-left:40px;padding-right:40px;}.css-8o6tot-Article .gatsby-resp-iframe-wrapper,.css-8o6tot-Article .gatsby-resp-image-wrapper,.css-8o6tot-Article .image-wrapper{margin-left:-60px!important;margin-right:-60px!important;}}@media (min-width: 30em) and (max-width: 38.125em){.css-8o6tot-Article .gatsby-resp-iframe-wrapper,.css-8o6tot-Article .gatsby-resp-image-wrapper,.css-8o6tot-Article .image-wrapper{margin-left:-56px!important;margin-right:-56px!important;}}@media (max-width: 30em){.css-8o6tot-Article{padding-left:0;padding-right:0;}.css-8o6tot-Article .gatsby-resp-iframe-wrapper,.css-8o6tot-Article .gatsby-resp-image-wrapper,.css-8o6tot-Article .image-wrapper{margin-left:-16px!important;margin-right:-16px!important;}}</style><article class="css-8o6tot-Article edaxc5g5"><p>안녕하세요. 메쉬코리아 기반서비스서버팀 강성일입니다.
이번에 Spatial data를 <strong>10,000배!</strong> 잘 다루게 된 방법에 대해 공유하고자 글을 쓰게 되었습니다 😀</p>
<p>들어가기에 앞서, <strong>메쉬코리아</strong>는 음식, 화장품, 편의점 상품과 같은 상품을 실시간으로 배송하는 서비스인 스마트 물류 플랫폼 <strong>부릉(Vroong)</strong> 🚛 을 운영하는 회사인데요.</p>
<p>배송 주문을 처리하기 위해서는</p>
<ul>
<li>상점과 고객 사이의 거리와 장애물 등을 고려하여 처리할 수 있는 주문건인가?</li>
<li>기사님께는 얼마만큼의 금액을 지불해야 하는가?</li>
<li>상점에서는 얼마만큼의 금액을 받아내야 하는가?</li>
</ul>
<p>를 판단해야 합니다.</p>
<p>그래서 <strong>spatial data</strong>를 이용하여 각 상점의 배송 가능한 권역들, 배송이 불가능한 권역들을 관리하는 권역 시스템을 운영하고 있습니다.</p>
<p>권역 시스템에서는 <strong>spatial data</strong>를 효율적으로 다루기 위해서 <strong>PostgreSQL</strong>에서 지원하는 <strong>PostGIS</strong>를 이용하고 있는데요.
<strong>지도 화면에서 보이는 영역과 행정동/법정동 polygon의 intersects를 계산하고 polygon을 가져오는 과정에서 큰 성능 이슈를 가지고 있었습니다.</strong> <em>(worst case에서는 조회시간이 60초 정도 걸렸습니다…눈물 😢 )</em></p>
<p>성능이 떨어지는 문제의 쿼리는 아래와 같았습니다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">SELECT region.*
FROM region
INNER JOIN address_polygon on region.pk=address_polygon.region_pk
INNER JOIN address on address_polygon.address_pk=address.pk
WHERE address.address_type = &#39;LEGAL&#39;
AND region.region_type = &#39;ADDRESS_REGION&#39;
AND region.status = &#39;ENABLED&#39;
AND st_intersects(
    region.polygon,
    ST_MakeEnvelope(126.9373539, 37.5210172, 127.0540836, 37.5873607, 4326)
);</code></pre></div>
<p><strong>[쿼리1]</strong></p>
<p>그럼 이 문제를 어떻게 해결했는지, <strong>어떻게 성능을 10,000배 올릴 수 있었는지</strong> 지금부터 이야기해보겠습니다!</p>
<h2 id="spatial-data의-intersects의-계산-방법"><a href="#spatial-data%EC%9D%98-intersects%EC%9D%98-%EA%B3%84%EC%82%B0-%EB%B0%A9%EB%B2%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Spatial data의 intersects의 계산 방법</h2>
<p>문제 상황에서 사용하는 spatial data는 2d의 polygon 입니다. 그리고 intersects는 두개의 polygon이 겹치는지를 판단하는
연산을 의미합니다. 이를 postgresql에서는 아래와 같이 사용합니다.</p>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> region <span class="token keyword">WHERE</span> region
<span class="token operator">AND</span> st_intersects<span class="token punctuation">(</span>
    region<span class="token punctuation">.</span><span class="token keyword">polygon</span><span class="token punctuation">,</span>
    ST_MakeEnvelope<span class="token punctuation">(</span><span class="token number">126.9373539</span><span class="token punctuation">,</span> <span class="token number">37.5210172</span><span class="token punctuation">,</span> <span class="token number">127.0540836</span><span class="token punctuation">,</span> <span class="token number">37.5873607</span><span class="token punctuation">,</span> <span class="token number">4326</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><strong>[쿼리2]</strong></p>
<p>위 쿼리는 region 테이블의 polygon 컬럼과 서울 종로구 부근의 영역을 비교하여 ‘겹치는 영역이 있는가’를 조건으로
select 하는데요. 약 천만개의 row가 있는 region 테이블에서도 0.5초내외의 성능을 보여주면서 의외로 빠른 성능을 보여줍니다.
intersects 연산이 단순하게 생각하면 무거운 연산일거라 추측할 수도 있습니다. 이 쿼리가 어떻게 빠르게 동작할 수 있는 것인지
의문이 드는데, 가능한 방법이 있습니다. 바로 <a href="https://en.wikipedia.org/wiki/R-tree">R-Tree</a>라는 자료구조를 사용한
index 구조를 통해 계산하면 intersects 계산을 빠르게 할 수 있다고 합니다.</p>
<p>R-tree의 인덱싱 방법은 B-tree와 유사한데, polygon 데이터들의 최소한의 bounding box를 구하고 그 박스 간의 포함관계를
B-tree의 형식으로 관리하는 index tree입니다. 이렇게 B-tree의 범위 조회와 같은 계산 방법으로 계산하면 포함관계와
교차관계(intersects)를 쉽게 계산할 수 있습니다. index search를 통해서 대충 intersects하는 polygon을 bounding box가
아닌 실제 polygon과의 intersects 연산을 한번 더 진행해서, 진짜 원하는 polygon이 맞는지 한번 더 선별과정을 거칩니다.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/6/6f/R-tree.svg"></p>
<p>이 권역 서비스는 처음부터 프로젝트에 involve된게 아니었기 때문에 위 문제의 쿼리1을 만났을때는
쿼리2를 테스트 해보지 않았습니다. 따라서 천만개의 row에 대해 intersects를 모두 계산한다고 생각했기 때문에, 어떻게 해도
빠르게 할 수 있는 방법이 없다고 생각했죠. 따라서 모든 폴리곤을 메모리에 올리고 최적화된 알고리즘을 구현해야겠다는
생각을 하면서 찾아보다가 R-tree에 대해서 알게 되었습니다.
R-tree 성능에 대해서 Python으로 구현해보고 충분히 빠른 것을 확인하였습니다. Python에서는 R-tree의 구현을
ctypes를 이용해 libspatialindex를 래핑한 <a href="https://pypi.org/project/Rtree/">라이브러리</a>를 찾을 수 있었습니다.</p>
<p>그래서 ‘PostGIS는 이런 것을 지원 안하나?’ 싶어서 찾아보게 되었는데 PostGIS도 R-tree와 같은 bounding box indexing을 지원한다는
것을 알게 되었고, 심지어 해당 인덱싱이 위의 쿼리에 <code class="language-text">polygon</code> 컬럼에 적용되어 있는 것을 확인했습니다.</p>
<p>정확히는 PostGIS는 R-Tree라는 이름으로 사용하지 않고 <a href="https://postgis.net/workshops/postgis-intro/indexing.html">GIST</a>
라는 이름으로 index 방법을 제공하고 있는것을 알게 되었습니다. 그리고 위 GIST의 링크를 읽어보면 나와 있는데,
bounding box간의 연산을 위해서 postgresql에서는 <a href="https://postgis.net/docs/reference.html#idm9871">특수한 연산자</a>를 따로
지원하고 있습니다. 또한 st_intersects는 이미 내부에서 <code class="language-text">&amp;&amp;</code> 연산자를 통해서 bounding box간의 연산을 하고 <code class="language-text">AND</code> 조건으로
실제 polygon이 intersects 하는 가를 판단한다는 것을 알게 되었습니다. 이 사실을 알고 위 쿼리 2를 작성하여 쿼리해보고,
0.5초의 성능이면 1분에 비해서는 굉장히 좋은 성능이 나온다는 것을 알 수 있었습니다. 그래서 어떻게 이 정도의 차이를 갖게 되는지
좀 더 정확히 알아보고자 <code class="language-text">explain analyze</code>를 해보게 되었습니다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Index Scan using polygon_geom_idx on region  (cost=0.42..513509.60 rows=... width=...) (actual time=0.136..515.878 rows=... loops=1)
    Index Cond: (polygon &amp;&amp; &#39;...&#39;::geometry)
    Filter: _st_intersects(polygon, &#39;...&#39;::geometry)
    Rows Removed by Filter: 383
Planning Time: 0.244 ms
Execution Time: 522.464 ms</code></pre></div>
<p>위 explain 결과를 보면 index condition으로 <code class="language-text">polygon</code> column 과 <code class="language-text">&amp;&amp;</code> 연산을 통해서 bounding box를 주어진
polygon 데이터와 비교하고, 후에 filter 조건으로 <code class="language-text">_st_intersects</code>를 사용하는 것을 확인할 수 있습니다.</p>
<h2 id="그러면-문제는-어디서-발생하는걸까"><a href="#%EA%B7%B8%EB%9F%AC%EB%A9%B4-%EB%AC%B8%EC%A0%9C%EB%8A%94-%EC%96%B4%EB%94%94%EC%84%9C-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94%EA%B1%B8%EA%B9%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>그러면 문제는 어디서 발생하는걸까?</h2>
<p>그렇다면 ‘문제가 된 쿼리 1은 도대체 무슨 문제가 있었던 건가?’ 싶어서 해당 쿼리도 <code class="language-text">explain analyze</code>를 돌려보았습니다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Gather  (cost=1080.01..67698.36 rows=... width=1894) (actual time=117.101..66590.220 rows=... loops=1)
  Workers Planned: 1
  Workers Launched: 1
  -&gt;  Nested Loop  (cost=80.01..66697.06 rows=8 width=1894) (actual time=66.379..65641.273 rows=134 loops=2)
        -&gt;  Nested Loop  (cost=79.58..51221.10 rows=1996 width=8) (actual time=63.748..5975.698 rows=401872 loops=2)
              -&gt;  Parallel Bitmap Heap Scan on address  (cost=79.14..10717.49 rows=1714 width=8) (actual time=57.163..61.659 rows=2526 loops=2)
                    Recheck Cond: ((address_type)::text = &#39;LEGAL&#39;::text)
                    Heap Blocks: exact=107
                    -&gt;  Bitmap Index Scan on address_address_type_index  (cost=0.00..78.42 rows=2914 width=0) (actual time=100.710..100.710 rows=5504 loops=1)
                          Index Cond: ((address_type)::text = &#39;LEGAL&#39;::text)
              -&gt;  Index Only Scan using address_polygon_pkey on address_polygon  (cost=0.43..23.23 rows=40 width=16) (actual time=0.579..2.307 rows=159 loops=5052)
                    Index Cond: (address_pk = address.pk)
                    Heap Fetches: 304308
        -&gt;  Index Scan using region_primary_key on region  (cost=0.43..7.75 rows=1 width=1894) (actual time=0.147..0.147 rows=0 loops=803744)
              Index Cond: (pk = address_polygon.region_pk)
              Filter: ((optimized_polygon_30 &amp;&amp; &#39;...&#39;::geometry) AND ((region_type)::text = &#39;ADDRESS_REGION&#39;::text) AND ((status)::text = &#39;ENABLED&#39;::text) AND _st_intersects(optimized_polygon_30, &#39;...&#39;::geometry)
              Rows Removed by Filter: 1
Planning Time: 3.403 ms
Execution Time: 66590.472 ms</code></pre></div>
<p>해당 쿼리를 살펴보면 polygon의 index를 타지 않고 쿼리가 되는 걸 확인했습니다. 다양한 방법으로 해당 쿼리를 시도해봤는데,
거의 대부분 <code class="language-text">address_address_type_index</code>를 타는 것을 확인할 수 있었습니다. 왜 그런지 이유를 찾아보고 싶었지만 명확하게
알 수 있는 방법은 없었고, 추론할 수 있는 근거들에 대해서는 몇 가지 알게 되었습니다. 가장 타당하다고 생각되는 근거는
위 <a href="https://postgis.net/workshops/postgis-intro/indexing.html#analyzing">Spartial indexing</a>에 대한 document에서 확인할
수 있었습니다.</p>
<blockquote>
<p>it is not always faster to do an index search: if the search is going to return every record
in the table, traversing the index tree to get each record will actually be slower than just sequentially reading
the whole table from the start.</p>
</blockquote>
<p>postgresql이 경우에 따라서 index를 타는 것이 비효율적이라 판단되면 풀서치하는 방향으로 optimize하는걸 알게 되었습니다.
어떤 기준으로 하는지가 불명확하고 vacuuming 해도 index를 사용할 때도 있고 안 할 때도 있어서 단순히 vacuuming으로는 일관적인
성능을 보장하기는 어렵다고 판단했습니다.</p>
<p>위에 region의 테이블이 약 천만개의 row가 있는데 실제로 그중 행정동/법정동과 시군구, 시도의 모든 폴리곤을 58,000개 정도 밖에 안돼서 postgresql이 <code class="language-text">spatial index</code>를 타는게 이득이 될 수 있다 판단할 수 있도록 row 수를 줄이고, join을 풀어서
<code class="language-text">spatial index</code>와 <code class="language-text">address_type index</code>를 병렬로 사용할 수 있도록 하기 위해서 table을 합칠까 생각하던 중
<a href="https://en.wikipedia.org/wiki/Materialized_view">materialized view</a>를 떠올리게 되었습니다.</p>
<p>oracle, postgresql, mariadb 에서는 일반적인 view와는 달리 물리적으로 어느 정도의 데이터를 저장하고 view의 column에
index를 적용할 수 있는 materialized view를 지원합니다. join 조건을 materialized view로 만들어서 최적화하고
<code class="language-text">polygon</code> 컬럼에 index를 적용 시켜준다면 spatial index 사이즈가 작아지면서 postgresql이 cost
계산을 더 잘 할 수 있을거라 추측해서 아래와 같이 적용해봤습니다.</p>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> MATERIALIZED <span class="token keyword">VIEW</span> address_region_view <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> ap<span class="token punctuation">.</span>region_pk<span class="token punctuation">,</span> region<span class="token punctuation">.</span><span class="token keyword">polygon</span><span class="token punctuation">,</span> ap<span class="token punctuation">.</span>address_type <span class="token keyword">FROM</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> address_polygon<span class="token punctuation">.</span>region_pk<span class="token punctuation">,</span> address<span class="token punctuation">.</span>address_type <span class="token keyword">FROM</span> address
    <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> address_polygon <span class="token keyword">ON</span> address<span class="token punctuation">.</span>pk <span class="token operator">=</span> address_polygon<span class="token punctuation">.</span>address_pk
    <span class="token keyword">WHERE</span> address<span class="token punctuation">.</span>address_type <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'LEGAL'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> ap
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> region <span class="token keyword">ON</span> region<span class="token punctuation">.</span>pk <span class="token operator">=</span> ap<span class="token punctuation">.</span>region_pk
<span class="token keyword">WHERE</span> region<span class="token punctuation">.</span>region_type <span class="token operator">=</span> <span class="token string">'ADDRESS_REGION'</span>
<span class="token operator">AND</span> region<span class="token punctuation">.</span><span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'ENABLED'</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> address_region_view_idx <span class="token keyword">ON</span> address_region_view <span class="token keyword">using</span> gist<span class="token punctuation">(</span><span class="token keyword">polygon</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> address_region_view_address_type_idx <span class="token keyword">ON</span> address_region_view <span class="token punctuation">(</span>address_type<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>쿼리1의 조건을 view로 녹여내고 index를 적용한 <code class="language-text">address_region_view</code>를 통해서 같은 결과가 나와야하는 쿼리를 재구성하여
explain을 통해 성능을 측정해봤습니다.</p>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> address_region_view
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> region <span class="token keyword">ON</span> region<span class="token punctuation">.</span>pk <span class="token operator">=</span> address_region_view<span class="token punctuation">.</span>region_pk
<span class="token keyword">WHERE</span> address_region_view<span class="token punctuation">.</span>address_type<span class="token operator">=</span><span class="token string">'LEGAL'</span>
    <span class="token operator">AND</span> st_intersects<span class="token punctuation">(</span>
        address_region_view<span class="token punctuation">.</span><span class="token keyword">polygon</span><span class="token punctuation">,</span>
        ST_MakeEnvelope<span class="token punctuation">(</span><span class="token number">126.9373539</span><span class="token punctuation">,</span> <span class="token number">37.5210172</span><span class="token punctuation">,</span> <span class="token number">127.0540836</span><span class="token punctuation">,</span> <span class="token number">37.5873607</span><span class="token punctuation">,</span> <span class="token number">4326</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>위 쿼리를 사용하여 explain 해보면 결과는 아래와 같습니다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Nested Loop Left Join  (cost=166.64..825.34 rows=32 width=1533) (actual time=1.660..6.270 rows=... loops=1)
  -&gt;  Bitmap Heap Scan on address_region_view  (cost=166.21..554.86 rows=32 width=8) (actual time=1.645..5.412 rows=... loops=1)
        Recheck Cond: ((polygon &amp;&amp; &#39;...&#39;::geometry) AND ((address_type)::text = &#39;LEGAL&#39;::text))
        Filter: _st_intersects(polygon, &#39;...&#39;::geometry)
        Rows Removed by Filter: 2
        Heap Blocks: exact=270
        -&gt;  BitmapAnd  (cost=166.21..166.21 rows=95 width=0) (actual time=1.573..1.573 rows=0 loops=1)
              -&gt;  Bitmap Index Scan on address_region_view_idx  (cost=0.00..52.81 rows=1137 width=0) (actual time=0.488..0.488 rows=1281 loops=1)
                    Index Cond: (polygon &amp;&amp; &#39;...&#39;::geometry)
              -&gt;  Bitmap Index Scan on address_region_view_address_type_idx  (cost=0.00..113.14 rows=4896 width=0) (actual time=1.003..1.003 rows=5048 loops=1)
                    Index Cond: ((address_type)::text = &#39;LEGAL&#39;::text)
  -&gt;  Index Scan using region_primary_key on region  (cost=0.43..8.45 rows=1 width=1533) (actual time=0.003..0.003 rows=1 loops=...)
        Index Cond: (pk = address_region_view.region_pk)
Planning Time: 0.686 ms
Execution Time: 6.408 ms</code></pre></div>
<p>총 실행시간이 66,590ms에서 6.4ms에 가깝게 줄어든것을 확인할 수 있었습니다!</p>
<h2 id="결론"><a href="#%EA%B2%B0%EB%A1%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>결론</h2>
<p>spatial data를 한 테이블에 너무 많은 데이터를 넣으면 index연산할때 원하지 않는 방식으로 계산할 여지가 있습니다.
따라서 최대한 실제 application이 필요로 하는 데이터만을 추려서 materialized view로 만든다면 성능에 개선이 있을 수 있습니다.
즉, <strong>기본에 충실하게 생각하면 됩니다…</strong> 😂</p>
<h2 id="마치며"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>마치며</h2>
<p>이로써 <strong>Spatial data</strong>의 성능을 <strong>10,000배 UP!</strong> 시킨 이야기가 끝이 났습니다.
이번 사례를 통해 많은 것을 배울 수 있었는데요. <strong>postgresql이 index를 타는 것이 비효율적이라 판단되면 풀서치하는 방향으로 optimize한다</strong>는 것을 알게 되었을 뿐만 아니라 <strong>기본에 충실하자..^^</strong> 는 교훈 역시 얻을 수 있었습니다!
앞으로도 좋은 사례가 있으면 다시 찾아오겠습니다 :)</p>
<p>그리고 늘 좋은 물류 BPO 서비스를 제공하기 위해 노력하고 있는 메쉬코리아 부릉, 많이 지켜봐주세요!</p>
<p>긴 글 읽어주셔서 감사합니다 😊</p></article></article></div></div></main><style data-emotion="css 2jxy3p-Wrapper">.css-2jxy3p-Wrapper{padding-bottom:1.187rem;}</style><footer class="css-2jxy3p-Wrapper e1tbim063"><style data-emotion="css u2k6lz-FooterContainer">.css-u2k6lz-FooterContainer{border-top:1px solid #E2E4EB;padding-top:2.187rem;}</style><style data-emotion="css 1al4zm4-StyledContainer-FooterContainer">.css-1al4zm4-StyledContainer-FooterContainer{margin-left:auto;margin-right:auto;width:auto;max-width:71.25rem;padding:0 20px;border-top:1px solid #E2E4EB;padding-top:2.187rem;}.css-1al4zm4-StyledContainer-FooterContainer::before,.css-1al4zm4-StyledContainer-FooterContainer::after{content:"";display:table;}.css-1al4zm4-StyledContainer-FooterContainer::after{clear:both;}@media (max-width: 38.125em){.css-1al4zm4-StyledContainer-FooterContainer{padding-left:16px;padding-right:16px;}}</style><div class="e1tbim062 css-1al4zm4-StyledContainer-FooterContainer e1ig3f2t0"><style data-emotion="css 1gbez60-CompanyLogo">.css-1gbez60-CompanyLogo{float:left;width:160px;}@media (max-width: 48em){.css-1gbez60-CompanyLogo{float:none;width:auto;}}</style><div class="css-1gbez60-CompanyLogo e1tbim061"><style data-emotion="css 1636f4y-IconWrapper">.css-1636f4y-IconWrapper{position:relative;display:inline-block;line-height:16px;color:#0971ce;}.css-1636f4y-IconWrapper>svg{vertical-align:top;}.css-1636f4y-IconWrapper>svg{fill:#0971ce;}</style><i class="css-1636f4y-IconWrapper e12rwrnm0" height="16" color="#0971ce"><svg width="121.15" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 136.29 18"><path d="M106.37,6.3c0-3.17-2.19-4.77-5.45-4.77H94.58V16.67h3.19v-5.6h2.47l3.26,5.6h3.61l-3.65-6A4.29,4.29,0,0,0,106.37,6.3ZM101,8.36H97.75V4.42H101c1.38,0,2.34.59,2.34,2S102.37,8.36,101,8.36Z"></path><polygon points="20.72 10.05 26.95 10.05 26.95 7.11 20.72 7.11 20.72 4.5 28.2 4.5 28.2 1.53 17.69 1.53 17.69 16.67 28.52 16.67 28.52 13.71 20.72 13.71 20.72 10.05"></polygon><polygon points="53.94 7.33 47.73 7.33 47.73 1.53 44.71 1.53 44.71 16.67 47.73 16.67 47.73 10.31 53.94 10.31 53.94 16.67 56.97 16.67 56.97 1.53 53.94 1.53 53.94 7.33"></polygon><path d="M85.36,1.17c-4,0-6.81,3-6.81,8S81.3,17,85.32,17s6.78-3,6.78-7.94S89.36,1.17,85.36,1.17Zm0,12.8c-2.15,0-3.65-1.78-3.65-4.89s1.43-4.85,3.58-4.85S88.94,6,88.94,9.12,87.51,14,85.36,14Z"></path><polygon points="112.64 10.05 118.87 10.05 118.87 7.11 112.64 7.11 112.64 4.5 120.12 4.5 120.12 1.53 109.61 1.53 109.61 16.67 120.45 16.67 120.45 13.71 112.64 13.71 112.64 10.05"></polygon><path d="M130.53,1.53h-2.94L121.8,16.67H125l1.19-3.37h5.54L133,16.67h3.33Zm-3.26,8.89,1-2.75c.31-.88.61-1.79.76-2.35.15.56.45,1.47.76,2.35l1,2.75Z"></path><path d="M7.35,8.18,3.2,1.53H.25V16.67h3V10.6c0-1.25,0-2.42,0-3.51l0,0C4,8.14,4.55,9.25,5.25,10.31L7,13h.54l1.76-2.7c.69-1.06,1.43-2.17,2.08-3.24l0,0c0,1.09,0,2.26,0,3.51v6.07h3V1.53H11.5Z"></path><path d="M37.13,7.5c-2.36-.55-3-1.15-3-2.09,0-.66.54-1.34,2.13-1.34A4.56,4.56,0,0,1,39.65,5.6L41.8,3.52a7.14,7.14,0,0,0-5.43-2.35C33.43,1.17,31,2.83,31,5.54c0,2.94,1.92,4.11,4.67,4.75S39,11.53,39,12.49c0,1.13-.83,1.62-2.6,1.62a4.8,4.8,0,0,1-3.81-1.71l-2.15,1.92A6.91,6.91,0,0,0,36.26,17c4.06,0,5.85-1.91,5.85-4.74C42.11,9,39.49,8.05,37.13,7.5Z"></path><polygon points="78.14 1.53 74.1 1.53 69.07 7.89 69.07 1.53 66.04 1.53 66.04 16.65 69.07 16.65 69.07 9.82 74.48 16.65 74.48 16.65 78.49 16.65 72.23 8.74 78.14 1.53"></polygon></svg></i></div><style data-emotion="css dtdcvy-CompanyDesc">.css-dtdcvy-CompanyDesc{margin-left:160px;}@media (max-width: 48em){.css-dtdcvy-CompanyDesc{margin-left:0;margin-top:1.5rem;}}@media (max-width: 38.125em){.css-dtdcvy-CompanyDesc{font-size:0.875rem;}}</style><div class="css-dtdcvy-CompanyDesc e1tbim060"><p>프리미엄 배달대행 부릉을 운영하는 메쉬코리아는 투명하고 유연하게 라이더를 연결하는 물류플랫폼을 지향합니다.<br/>물류플랫폼을 함께 만들어갈 능력있는 사람들과 함께할 사람들을 찾습니다.</p><p><a href="https://www.meshkorea.net/kr/career/" target="_blank">지금 지원하러 가기 <i class="css-1anhml5-IconWrapper e12rwrnm0" height="16"><svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M12,8a1,1,0,0,1-.29.71l-5,5a1,1,0,0,1-1.42-1.42L9.59,8,5.29,3.71A1,1,0,0,1,6.71,2.29l5,5A1,1,0,0,1,12,8Z"></path></svg></i></a></p></div></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-71371143-19',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-71371143-19', 'auto', {});
      ga('set', 'anonymizeIp', true);
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/20210120-dev-note-001-spatial-data/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-dfda8d059abd9d0298c4.js"],"app":["/app-22865dd68e8243d4cdbd.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-15fbe9adb4b555b35bae.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-dbc6469e7318acc07548.js"],"component---src-templates-pages-tsx":["/component---src-templates-pages-tsx-faf52131eb81a2acc5f6.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-826d2b9ff3a07b601cb2.js"],"component---src-templates-tags-tsx":["/component---src-templates-tags-tsx-f9a749b633c17bb4de81.js"]};/*]]>*/</script><script src="/polyfill-dfda8d059abd9d0298c4.js" nomodule=""></script><script src="/component---src-templates-post-tsx-826d2b9ff3a07b601cb2.js" async=""></script><script src="/commons-dcdf0d39b8604fc9401a.js" async=""></script><script src="/e0525e89-740ce12359b8b303d957.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-22865dd68e8243d4cdbd.js" async=""></script><script src="/framework-da68acf1b9295dbf7273.js" async=""></script><script src="/webpack-runtime-1294f826c36834da02c4.js" async=""></script></body></html>